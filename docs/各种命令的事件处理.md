## /continue

1. handler.go: 读取模型参数和其余args，要是没读到模型参数就使用默认模型
2. handler.go: 169行，执行ContinuePRWithArgsAndAI()
3. agent.go: 542, processPRWithArgsAndAI(xxx. "continue")
4. GetOrCreateWorkspaceForPRWithAI（）*获取或创建 PR 工作空间，包含AI模型信息*
5. *拉取远端最新代码*
6. *获取所有PR评论历史用于构建上下文*
7. *构建包含历史上下文的 prompt*

> ### 1. 初始化阶段
> ```go
> var prompt string
> var taskDescription string
> var defaultTask string
> ```
> 定义三个变量来存储最终结果和任务描述。
>
> ### 2. 模式判断（switch 语句）
> 根据 `mode` 参数设置不同的任务描述：
>
> | 模式       | taskDescription                                              | defaultTask                      |
> | ---------- | ------------------------------------------------------------ | -------------------------------- |
> | "Continue" | "请根据上述PR描述、历史讨论和当前指令，进行相应的代码修改。" | "继续处理PR，分析代码变更并改进" |
> | "Fix"      | "请根据上述PR描述、历史讨论和当前指令，进行相应的代码修复。" | "分析并修复代码问题"             |
> | 其他       | "请根据上述PR描述、历史讨论和当前指令，进行相应的代码处理。" | "处理代码任务"                   |
>
> ### 3. 提示词构建逻辑（双重条件判断）
>
> #### 条件1：是否有具体指令（args != ""）
> - **有指令 + 有历史上下文**：
>   ```
>   作为PR代码审查助手，请基于以下完整上下文来[模式]：
>   
>   [历史上下文]
>   
>   ## 当前指令
>   [args]
>   
>   [taskDescription]注意：
>   1. 当前指令是主要任务，历史信息仅作为上下文参考
>   2. 请确保修改符合PR的整体目标和已有的讨论共识
>   3. 如果发现与历史讨论有冲突，请优先执行当前指令并在回复中说明
>   ```
>
> - **有指令 + 无历史上下文**：
>   ```
>   根据指令[模式]：
>   
>   [args]
>   ```
>
> #### 条件2：是否有历史上下文（historicalContext != ""）
> - **无指令 + 有历史上下文**：
>   ```
>   作为PR代码审查助手，请基于以下完整上下文来[模式]：
>   
>   [历史上下文]
>   
>   ## 任务
>   [defaultTask]
>   
>   请根据上述PR描述和历史讨论，进行相应的代码修改和改进。
>   ```
>
> - **无指令 + 无历史上下文**：
>   ```
>   [defaultTask]
>   ```
>
> ## 逻辑流程图
>
> ```
> 开始
>   ↓
> 设置 taskDescription 和 defaultTask（根据 mode）
>   ↓
> args != "" ?
>   ├─ 是 → historicalContext != "" ?
>   │         ├─ 是 → 构建完整提示词（包含历史上下文和当前指令）
>   │         └─ 否 → 构建简单提示词（仅当前指令）
>   └─ 否 → historicalContext != "" ?
>             ├─ 是 → 构建基于历史上下文的提示词
>             └─ 否 → 使用默认任务描述
>   ↓
> 返回构建好的 prompt
> ```
>

7. 执行AI处理；resp, err := a.promptWithRetry(ctx, codeClient, prompt, 3) agent.go : 435
8. *提交变更并更新 PR*, *Continue模式不返回错误，继续执行评论*
9. *评论到 PR*